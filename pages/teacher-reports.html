<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Laporan Wali Kelas - Guru Area</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/tables.css" />
    <link rel="stylesheet" href="../css/notifications.css" />
    <link rel="stylesheet" href="../css/responsive.css" />
    <link rel="stylesheet" href="../css/teacher.css" />

    <style>
      /* --- STYLE HALAMAN LAPORAN --- */

      /* 1. KARTU STATISTIK (Responsive Grid) */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(
          auto-fit,
          minmax(200px, 1fr)
        ); /* Otomatis turun kalau sempit */
        gap: 20px;
        margin-bottom: 30px;
      }
      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #0f766e;
      }
      .stat-card h3 {
        margin: 0;
        font-size: 32px;
        color: #111827;
        font-family: "Poppins", sans-serif;
      }
      .stat-card p {
        margin: 5px 0 0 0;
        color: #6b7280;
        font-size: 14px;
      }

      .section-title {
        font-size: 16px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 15px;
        border-left: 4px solid #f59e0b;
        padding-left: 10px;
      }

      /* 2. LAYOUT KOLOM LAPORAN (FIX SCROLL X) */
      .report-columns {
        display: grid;
        grid-template-columns: 1fr 1fr; /* Default: 2 Kolom */
        gap: 20px;
        margin-bottom: 40px;
      }

      /* Agar tabel tidak memaksa layar melebar */
      .table-container {
        width: 100%;
        overflow-x: auto; /* Scroll HANYA di dalam tabel jika sempit, bukan satu halaman */
      }

      /* Override aturan min-width tabel khusus di halaman ini agar fleksibel */
      .premium-table {
        min-width: 100%; /* Jangan dipaksa 600px */
        width: 100%;
      }

      /* BREAKPOINT: Jika layar < 1200px (Laptop Kecil/Tablet), jadikan 1 kolom ke bawah */
      @media (max-width: 1200px) {
        .report-columns {
          grid-template-columns: 1fr;
        }
      }

      /* 3. PRINT STYLES (Kop Surat & Tanda Tangan) */
      .print-header {
        display: none;
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 3px double #000;
        padding-bottom: 10px;
      }
      .print-header h2 {
        margin: 0;
        font-size: 24px;
        text-transform: uppercase;
        color: #000;
      }
      .print-header p {
        margin: 5px 0 0 0;
        font-size: 14px;
        color: #000;
      }

      .signature-section {
        display: none;
        margin-top: 50px;
        justify-content: space-between;
        page-break-inside: avoid;
      }
      .sig-box {
        text-align: center;
        width: 200px;
        color: #000;
      }
      .sig-name {
        margin-top: 80px;
        font-weight: bold;
        text-decoration: underline;
      }

      /* --- SETUP KHUSUS MODE CETAK (CTRL+P) --- */
      @media print {
        @page {
          size: A4;
          margin: 2cm;
        } /* Set Kertas A4 */

        /* Sembunyikan elemen UI Aplikasi */
        .sidebar,
        .btn-menu-mobile,
        .sidebar-overlay,
        .btn-refresh,
        .no-print {
          display: none !important;
        }

        /* Reset Layout agar Full Kertas */
        body {
          background: white;
          font-family: "Times New Roman", serif;
          color: black;
          font-size: 12pt;
        }
        .app-container {
          display: block;
        }
        .main-content {
          margin: 0;
          padding: 0;
          width: 100%;
        }

        /* Tampilkan Elemen Cetak */
        .print-header,
        .signature-section {
          display: flex;
        } /* Flex untuk signature biar kanan-kiri */
        .print-header {
          display: block;
        } /* Header block biasa */

        /* Tabel Cetak */
        .premium-table th {
          background-color: #eee !important;
          color: black !important;
          border: 1px solid #000;
          font-weight: bold;
        }
        .premium-table td {
          border: 1px solid #000;
          color: black;
        }
        .premium-table {
          border-collapse: collapse;
          width: 100%;
          min-width: 0;
        }

        /* Hilangkan Grid Statistik saat print (Opsional, biar hemat tinta) atau sesuaikan */
        .stats-grid {
          grid-template-columns: 1fr 1fr 1fr;
          gap: 10px;
          page-break-inside: avoid;
        }
        .stat-card {
          border: 1px solid #000;
          box-shadow: none;
          padding: 10px;
        }
        .stat-card h3 {
          font-size: 20px;
        }

        /* Pastikan layout kolom jadi 1 baris ke bawah jika kertas sempit, atau biarkan 2 kolom jika muat */
        .report-columns {
          display: block;
        }
        .report-columns > div {
          margin-bottom: 20px;
          page-break-inside: avoid;
        }

        .top-bar {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div class="app-container">
      <button class="btn-menu-mobile no-print" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
      </button>

      <aside class="sidebar no-print">
        <div class="sidebar-header">
          <i class="fa-solid fa-chalkboard-user logo-icon"></i>
          <h2>GURU AREA</h2>
        </div>
        <nav class="sidebar-menu">
          <a href="teacher-dashboard.html" class="menu-item">
            <i class="fa-solid fa-gauge-high icon"></i> Dashboard
          </a>
          <a href="teacher-schedule.html" class="menu-item">
            <i class="fa-solid fa-calendar-days icon"></i> Jadwal Mengajar
          </a>
          <div
            style="
              margin: 10px 20px;
              font-size: 12px;
              color: rgba(255, 255, 255, 0.5);
              text-transform: uppercase;
              font-weight: bold;
            "
          >
            Wali Kelas
          </div>
          <a href="#" class="menu-item active">
            <i class="fa-solid fa-chart-pie icon"></i> Laporan Kelas
          </a>
          <a href="teacher-attendance.html" class="menu-item">
            <i class="fa-solid fa-clipboard-user icon"></i> Absensi Harian
          </a>
          <a href="teacher-students.html" class="menu-item">
            <i class="fa-solid fa-user-graduate icon"></i> Data Siswa
          </a>
          <a href="teacher-points.html" class="menu-item">
            <i class="fa-solid fa-star icon"></i> Input Poin
          </a>
        </nav>
        <div class="sidebar-footer">
          <a href="#" class="menu-item logout"
            ><i class="fa-solid fa-right-from-bracket icon"></i> Keluar</a
          >
        </div>
      </aside>

      <main class="main-content">
        <div class="print-header">
          <h2>SMK TEKNOLOGI MASA DEPAN</h2>
          <p>Jl. Pendidikan No. 123, Kota Banjarmasin, Kalimantan Selatan</p>
          <p>Telp: (0511) 123456 | Email: info@smktekno.sch.id</p>
          <hr style="margin-top: 10px; border: 1px solid #000" />
          <h3 style="margin: 20px 0 5px 0; font-size: 18px">
            LAPORAN REKAPITULASI KELAS
          </h3>
          <p id="print-subtitle" style="font-weight: bold">
            Tahun Ajaran 2025/2026
          </p>
        </div>

        <header class="top-bar no-print">
          <div>
            <h1>Laporan Wali Kelas</h1>
            <p class="subtitle" id="class-subtitle">Memuat data kelas...</p>
          </div>

          <div style="display: flex; gap: 10px; align-items: center">
            <select
              id="class-selector"
              style="
                padding: 8px 12px;
                border-radius: 8px;
                border: 1px solid #ccc;
                display: none; /* Sembunyi dulu kalau kelas cuma 1 */
                cursor: pointer;
                font-weight: 600;
                color: #374151;
              "
            ></select>

            <button
              class="btn-refresh"
              onclick="window.print()"
              style="background: #0f766e; color: white; border: none"
            >
              <i class="fa-solid fa-print"></i> Cetak
            </button>
          </div>
        </header>

        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="total-students">0</h3>
            <p>Total Siswa</p>
          </div>
          <div class="stat-card" style="border-left-color: #dc2626">
            <h3 id="total-violations">0</h3>
            <p>Poin Pelanggaran</p>
          </div>
          <div class="stat-card" style="border-left-color: #10b981">
            <h3 id="avg-attendance">0%</h3>
            <p>Rata-rata Kehadiran</p>
          </div>
        </div>

        <div class="report-columns no-print">
          <div>
            <h4 class="section-title">‚ö†Ô∏è Siswa Sering Alpha (Top 5)</h4>
            <div class="table-container">
              <table class="premium-table">
                <thead>
                  <tr>
                    <th>Nama Siswa</th>
                    <th>Alpha</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="top-alpha-body"></tbody>
              </table>
            </div>
          </div>
          <div>
            <h4 class="section-title" style="border-color: #dc2626">
              üõë Poin Tertinggi (Top 5)
            </h4>
            <div class="table-container">
              <table class="premium-table">
                <thead>
                  <tr>
                    <th>Nama Siswa</th>
                    <th>Poin</th>
                    <th>Tindakan</th>
                  </tr>
                </thead>
                <tbody id="top-points-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <h4 class="section-title" style="border-color: #4f46e5">
          üìã Data Lengkap Siswa
        </h4>
        <div class="table-container">
          <table class="premium-table">
            <thead>
              <tr>
                <th style="width: 40px">No</th>
                <th>NIS</th>
                <th>Nama Lengkap</th>
                <th>L/P</th>
                <th style="text-align: center">Kehadiran</th>
                <th style="text-align: center">Poin</th>
                <th>Catatan Wali Kelas</th>
              </tr>
            </thead>
            <tbody id="full-student-list"></tbody>
          </table>
        </div>

        <div class="signature-section">
          <div class="sig-box">
            <p>Mengetahui,<br />Kepala Sekolah</p>
            <div class="sig-name">Dr. Budi Santoso, M.Pd</div>
            <p>NIP. 19800101 200501 1 001</p>
          </div>
          <div class="sig-box">
            <p>Banjarmasin, <span id="print-date"></span><br />Wali Kelas</p>
            <div class="sig-name" id="sig-teacher-name">Nama Guru</div>
            <p>NIP. -</p>
          </div>
        </div>
      </main>
    </div>

    <script type="module" src="../js/app.js"></script>
    <script src="../js/utils/notifications.js"></script>
    <script
      type="module"
      src="../js/views/pages/reports/teacher-view.js"
    ></script>
  </body>
</html>
